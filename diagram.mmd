graph TB
    subgraph "Client - Browser"
        subgraph "Pages"
            LoginPage[Login Page]
            RegisterPage[Register Page]
            CanvasPage[Canvas Page]
        end
        
        subgraph "UI Components"
            Header[Header<br/>Logo, Logout, Connection Status]
            Toolbar[Toolbar<br/>Rectangle, Select, Color Picker]
            UserListModal[User List Modal<br/>Online Users with Avatars]
            LoginForm[Login Form]
            RegisterForm[Register Form]
        end
        
        subgraph "Canvas Components"
            Canvas[Canvas Component<br/>Main Orchestrator]
            CanvasStage[Canvas Stage]
            Rectangle[Rectangle Component]
            Transformer[Transformer]
            Cursor[Cursor Component<br/>Multiplayer Cursors]
            Grid[Grid Component<br/>Background Grid]
        end
        
        subgraph "Custom Hooks"
            useAuth[useAuth<br/>Authentication State]
            useCanvas[useCanvas<br/>Canvas State & Operations]
            useRealtime[useRealtime<br/>Dual Channel Architecture]
            useOwnership[useOwnership<br/>Direct DB Operations]
        end
        
        subgraph "Utils"
            SupabaseClient[Supabase Client]
            AuthLib[Auth Lib]
            ColorUtils[Color Utils]
        end
    end
    
    subgraph "Supabase Backend"
        Supabase[Supabase<br/>Auth + Database + Realtime<br/>profiles & canvas_objects tables<br/>Dual Channel Architecture]
    end
    
    %% Page Navigation
    LoginPage --> LoginForm
    RegisterPage --> RegisterForm
    CanvasPage --> Header
    CanvasPage --> Toolbar
    CanvasPage --> Canvas
    CanvasPage --> UserListModal
    
    %% Canvas Component Tree
    Canvas --> CanvasStage
    CanvasStage --> Grid
    CanvasStage --> Rectangle
    CanvasStage --> Cursor
    Canvas --> Transformer
    
    %% Hook Usage
    LoginForm --> useAuth
    RegisterForm --> useAuth
    Canvas --> useCanvas
    Canvas --> useRealtime
    Canvas --> useOwnership
    Header --> useAuth
    UserListModal --> useRealtime
    
    %% Hooks to Utils
    useAuth --> AuthLib
    useAuth --> SupabaseClient
    useCanvas --> SupabaseClient
    useCanvas --> ColorUtils
    useRealtime --> SupabaseClient
    useOwnership --> SupabaseClient
    
    %% Utils to Supabase
    AuthLib --> Supabase
    SupabaseClient --> Supabase
    
    %% Data Flow
    Canvas -->|CRUD Operations| Supabase
    Canvas -->|Cursor Movement| Supabase
    Canvas -->|User Presence| Supabase
    useOwnership -->|Atomic Ownership Updates| Supabase
    Supabase -->|Real-time Events| useRealtime
    Supabase -->|Ownership Changes| useOwnership
    
    %% Database Persistence
    Rectangle -->|Save State| Supabase
    Canvas -->|Load Objects| Supabase
    
    %% Auth Flow
    LoginForm -->|Login Request| Supabase
    RegisterForm -->|Register Request| Supabase
    
    %% Styling
    classDef clientClass fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef supabaseClass fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    
    class LoginPage,RegisterPage,CanvasPage,Header,Toolbar,UserListModal,LoginForm,RegisterForm clientClass
    class Canvas,CanvasStage,Rectangle,Transformer,Cursor,Grid clientClass
    class useAuth,useCanvas,useRealtime,useOwnership clientClass
    class SupabaseClient,AuthLib,ColorUtils clientClass
    
    class Supabase supabaseClass